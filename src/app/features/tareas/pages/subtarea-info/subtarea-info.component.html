  <ion-header>

    <ion-toolbar>
      <ion-buttons slot="start">
        <ion-button fill="clear" size="small" (click)="goBack()">
          <ion-icon name="chevron-back-outline" style="font-size: 20px;" class="text-[#3B82F6]"></ion-icon>
        </ion-button>
      </ion-buttons>

      <ion-title>
       <span class="-ml-12 [#000000]" *ngIf="tareasService.apartadoadmin === false">Tarea N° 0{{tarea?.id}}</span>
       <span class="-ml-12 [#000000]" *ngIf="tareasService.apartadoadmin === true">Tarea</span>
      </ion-title>

  </ion-toolbar>
  </ion-header>
<ion-content style="--padding-top: 0; --padding-bottom: 0; --padding-start: 0; --padding-end: 0; --background:white;">
  <div class="h-full flex flex-col">

  <!-- Tarjeta de tarea -->
  <div class="m-4">
    <div class="p-4 bg-blue-50 rounded-lg border-l-4 border-blue-400">
      <div class="flex items-center gap-2">
        <!-- <ion-icon name="briefcase" style="font-size: 14px;" class="text-blue-400"></ion-icon>
        <span class="text-blue-600 text-sm font-semibold uppercase">TAREA:</span> -->
        <p class="text-gray-800 text-xs font-semibold">
        {{tarea?.titulo}}
      </p>
        <div class="px-3 py-1 rounded-full flex items-center gap-1 ml-auto whitespace-nowrap"
        [ngClass]="{
               'bg-[#FFC800]': tarea?.estado === 'Pendiente',
               'bg-[#3B82F6]': tarea?.estado === 'En progreso',
               'bg-[#6DC560]': tarea?.estado === 'Completada',
               'bg-[#C7C7C7]': tarea?.estado === 'Cerrada'
             }">
          <span class="text-white text-[10px] font-medium">{{tarea?.estado || 'Pendiente'}}</span>
        </div>
        
      </div>
      
    </div>
  </div>
  <!-- Descripción -->
  <div class="px-4 mb-2">
    <h2 class="text-[#636E95] text-xs font-bold mb-1">Descripción</h2>
    <p class="text-[#000000] font-normal text-[10px] leading-relaxed">
      {{tarea?.descripcion}}
    </p>
  </div>

  <!-- Información de la tarea -->
  <div class="px-4">
    <!-- Categoría -->
    <div class="flex gap-16 mb-1" *ngIf="tareasService.apartadoadmin === false">
      <div class="flex flex-row items-center gap-1">
      <ion-icon name="layers-outline" style="font-size: 10px; font-weight: normal;" class="text-[#363636]"></ion-icon>
      <span class="text-[#363636] text-[10px] font-normal">Categoría: {{tarea?.Categoria || 'Sin categoría'}}</span>
      </div>
      <div class="flex flex-row items-center gap-1">
        <ion-icon name="layers-outline" style="font-size: 10px; font-weight: normal;" class="text-[#363636]"></ion-icon>
        <span class="text-[#363636] text-[10px] font-normal">SubCategoría: {{tarea?.Categoria || 'Sin categoría'}}</span>
      </div>
    </div>
    <div class="flex gap-4 mb-1" *ngIf="tareasService.apartadoadmin === true">
      <div class="flex flex-row items-center gap-1 w-[122px]">
      <ion-icon name="layers-outline" style="font-size: 10px; font-weight: normal;" class="text-[#363636]"></ion-icon>
      <span class="text-[#363636] text-[10px] font-normal">Subcategoría: {{tarea?.Categoria || 'Sin categoría'}}</span>
      </div>
      <div class="flex flex-row items-center gap-1 ">
        <ion-icon name="folder-open-outline" style="font-size: 10px; font-weight: normal;" class="text-[#363636]"></ion-icon>
        <span class="text-[#363636] text-[10px] font-normal">Estado: {{tarea?.estado || 'Sin categoría'}}</span>
      </div>
      <!-- <div class="flex flex-row items-center gap-1 w-[100px]">
        <fa-icon [icon]="faFlag" class="text-xxs text-[#363636] " ></fa-icon>
        <span class="text-[#363636] text-[10px] font-normal">Prioridad: {{tarea?.Prioridad || 'Sin categoría'}}</span>
      </div> -->
    </div>
    
    <div class="flex flex-row gap-4 items-center ">

    <!-- Horario -->
      <div class="flex items-center gap-1 w-[122px] ">
        <ion-icon name="time-outline" style="font-size: 10px; font-weight: normal;" class="text-[text-[#363636]]"></ion-icon>
        <span class="text-[#363636] text-[10px] font-normal">Programada: {{tarea?.horainicio}}</span>
      </div>

    <!-- Progreso -->
        <div class="flex flex-row items-center gap-1 " >
        <ion-icon name="time-outline" style="font-size: 10px; font-weight: normal;" class="text-[text-[#363636]]"></ion-icon>
        <span class="text-[#363636] text-[10px] font-normal">Hora Inicio: {{tarea?.horainicio || 'Sin hora inicio'}}</span>
        </div>
        <div class="flex flex-row items-center gap-1">
        <ion-icon name="time-outline" style="font-size: 10px; font-weight: normal;" class="text-[text-[#363636]]"></ion-icon>
        <span class="text-[#363636] text-[10px] font-normal">Hora fin: {{tarea?.horafin || 'Sin hora fin'}}</span>
        </div>
      
    </div>
    <div *ngIf="tareasService.apartadoadmin === false" class="p-2 w-[71px] h-[18px] rounded-full flex items-center justify-center gap-1 mt-2" [ngClass]="{
               'bg-success-5 ': tarea?.Prioridad === 'Baja',
                'bg-yellow-5': tarea?.Prioridad === 'Media',
                'bg-danger-5': tarea?.Prioridad === 'Alta'
             }">
        <fa-icon [icon]="faFlag" class="text-xxs" style="font-size: 10px;" [ngClass]="{
               'text-yellow-500': tarea?.Prioridad === 'Media',
               'text-[#EF4444]': tarea?.Prioridad === 'Alta',
               'text-success': tarea?.Prioridad === 'Baja',
             }"></fa-icon>
        <span class="text-[10px] font-normal " [ngClass]="{
               'text-yellow-500': tarea?.Prioridad === 'Media',
               'text-[#EF4444]': tarea?.Prioridad === 'Alta',
               'text-success': tarea?.Prioridad === 'Baja',
             }">
          {{tarea?.Prioridad}}
        </span>
    </div>
  </div>

  <div class="w-full px-4 mt-2" *ngIf="tarea?.estado === 'Pendiente'">
    <div class=" p-[4px] bg-[#FFF3EC] rounded flex flex-row items-center gap-2">
      <ion-icon name="information-circle-outline" class="text-orange-400 text-[10px] "></ion-icon>
      <span class="text-[10px] text-[#FF8947]">Para agregar un comentario o imagen, inicia la tarea.</span>
    </div>
  </div>

  <!-- Comentarios -->
  <div class="px-4 pt-4" *ngIf="tarea?.estado!== 'Cerrada' && tarea?.estado!== 'Completada'">
    <h3 class="text-gray-700 text-xs font-bold mb-1">Agrega un comentario <span class="text-[10px]">(Opcional)</span></h3>
    <ion-textarea
      [(ngModel)]="comentario"
      placeholder="Escribe aqui" 
      rows="4"
      [disabled]="tarea?.estado === 'Pendiente'"
      class="w-full border rounded-lg text-sm"
      fill="outline">
    </ion-textarea>
  </div>
  <div class="px-4 pt-2" *ngIf="tarea?.estado === 'Cerrada' || tarea?.id === '1'">
    <h3 class="text-gray-700 text-xs font-bold mb-1">Agrega un comentario <span class="text-[10px]">(Opcional)</span></h3>
    <div class="p-1 bg-[#F2F5FB] rounded-lg">
    <span class="text-xs font-normal text-[#878787] italic">No hay comentario.</span>
    </div>
  </div>
  <div class="px-4 pt-4" *ngIf="tarea?.estado=== 'Completada' && tarea?.id !== '1'">
    <h3 class="text-gray-700 text-xs font-bold mb-1">Agrega un comentario <span class="text-[10px]">(Opcional)</span></h3>
    <div class="p-2 bg-[#F2F5FB] rounded-lg flex">
    <span class="text-xxs font-normal text-[#878787] ">Me tomó más tiempo del necesario debido a la gran cantidad de personas por atender.</span>
    </div>
  </div>

  
  

  <!-- Archivos adjuntos -->
  <div class="px-4 pt-4">
    <h3 class="text-gray-700 text-xs font-bold mb-1">Archivos adjuntos <span class="text-[10px]">(Opcional)</span></h3>
    <!-- Texto informativo -->
    <div class="flex items-start gap-2 mb-2">
      <ion-icon name="information-circle-outline" style="font-size: 12px;" class="text-blue-500 mt-0.5 flex-shrink-0"></ion-icon>
      <p class="text-gray-500 text-xxs">
        Puedes adjuntar más de una imagen  ≤ 5MB como evidencia.
      </p>
    </div>
    <!-- Botón subir archivo -->
     <div class="flex flex-wrap gap-2" *ngIf="tarea?.estado!== 'Cerrada' && tarea?.estado !== 'Completada' && tarea?.id !== '1'">
      <!-- Botón para subir imagen (solo si hay menos de 5 imágenes) -->
      <button 
        *ngIf="archivosSubidos.length < 5"
        class="p-[10px] w-[68px] h-[68px] border-2 border-dashed border-[#C7C7C7] rounded-lg text-gray-500 flex flex-col items-center justify-center gap-1"
        (click)="subirArchivo()" [disabled]="tarea?.estado === 'Pendiente'">
        <ion-icon name="cloud-upload-outline" style="font-size: 12px;" class="font-normal text-[#000000]"></ion-icon>
        <span class=" text-[10px] font-normal leading-[10px] text-[#000000]">Subir <span>imagen</span></span>
      </button>
      
      <!-- Lista de imágenes subidas -->
      <ng-container *ngIf="archivosSubidos.length > 0">
        <div *ngFor="let archivo of archivosSubidos" 
             class="relative w-[68px] h-[68px] border-2 border-dashed border-[#C7C7C7] rounded-lg">
          <!-- Imagen -->
          <img [src]="archivo.src" 
               class="w-full h-full object-cover rounded-lg" 
               [alt]="archivo.nombre">
          
          <!-- Overlay con información y botón eliminar -->
          <div class="absolute -top-2 -right-2 flex justify-between items-center text-white text-xs p-1">
            <button (click)="eliminarArchivo(archivo)" 
                    class="text-white rounded-full bg-red-500 w-4 h-4 flex items-center justify-center text-[8px]">
              <fa-icon [icon]="faXmark"></fa-icon>
            </button>
          </div>
        </div>
      </ng-container>
      
      <!-- Mostrar contador de imágenes -->
      <div *ngIf="archivosSubidos.length > 0" class="text-xs text-gray-500 mt-2">
        {{archivosSubidos.length}}/5 imágenes
      </div>
     </div>
    <div class="pt-2" *ngIf="tarea?.estado === 'Cerrada' || tarea?.id === '1'">
    <div class="p-1 bg-[#F2F5FB] rounded-lg">
    <span class="text-xs font-normal text-[#878787] italic">No hay archivo adjunto.</span>
    </div>
  </div>
  <div *ngIf="tarea?.estado === 'Completada' && tarea?.id !== '1'" 
           class="bg-image p-[10px] relative w-[68px] h-[68px] border-2 border-dashed border-[#C7C7C7] rounded-lg text-gray-500 flex flex-col items-center justify-center gap-1">
      </div>
    

    <!-- Lista de archivos subidos (si los hay) -->
    
  </div>

  <!-- Toast personalizado posicionado -->
  <div class="fixed bottom-20 left-0 z-50" *ngIf="mostrarToastComponent">
    <app-toast-notificacion
      [config]="configToast"
      [duracion]="duracionToast"
      (cerrarClick)="onCerrarToast()"
      (botonClick)="onBotonToast()">
    </app-toast-notificacion>
  </div>

  <div class="p-4 sticky bottom-0 z-10 bg-white mt-auto" *ngIf="shouldShowFooter()">
    <ion-button 
      expand="block" 
      [color]="getButtonColor()"
      (click)="handleButtonClick()"
      [disabled]="isButtonDisabled()">
      <span>{{getButtonText()}}</span>
    </ion-button>
  </div>

  </div>
</ion-content>
